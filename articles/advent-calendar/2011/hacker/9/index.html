<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>App::Donburi - IRCを使い倒すアプリ - Articles Advent Calendar 2011 Hacker</title>
        <meta name="title" content="App::Donburi - IRCを使い倒すアプリ - Articles Advent Calendar 2011 Hacker">
        <meta name="description" content="">
        <meta name="author" content="kan">

        <meta property="og:type" content="website">
        <meta property="og:url" content="https://perl-users.jp/articles/advent-calendar/2011/hacker/9">
        <meta property="og:title" content="App::Donburi - IRCを使い倒すアプリ - Articles Advent Calendar 2011 Hacker">
        <meta property="og:description" content="">
        <meta property="og:image" content="https://res.cloudinary.com/kfly8/image/upload/l_text:NotoSansJP-Black.otf_50_bold:App%3A%3ADonburi%20-%20IRC%E3%82%92%E4%BD%BF%E3%81%84%E5%80%92%E3%81%99%E3%82%A2%E3%83%97%E3%83%AA,co_rgb:000000,w_900,c_fit/l_text:NotoSansJP-Black.otf_30_bold:kan,co_rgb:000000,g_south_east,x_130,y_120/v1601626948/og-perl-users-jp.png">

        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://perl-users.jp/articles/advent-calendar/2011/hacker/9">
        <meta property="twitter:title" content="App::Donburi - IRCを使い倒すアプリ - Articles Advent Calendar 2011 Hacker">
        <meta property="twitter:description" content="">
        <meta property="twitter:image" content="https://res.cloudinary.com/kfly8/image/upload/l_text:NotoSansJP-Black.otf_50_bold:App%3A%3ADonburi%20-%20IRC%E3%82%92%E4%BD%BF%E3%81%84%E5%80%92%E3%81%99%E3%82%A2%E3%83%97%E3%83%AA,co_rgb:000000,w_900,c_fit/l_text:NotoSansJP-Black.otf_30_bold:kan,co_rgb:000000,g_south_east,x_130,y_120/v1601626948/og-perl-users-jp.png">

        <link rel="icon" href="/img/favicon.ico">
        <link rel="canonical" href="https://perl-users.jp/articles/advent-calendar/2011/hacker/9">
        <link href="TODO" rel="stylesheet">
    </head>
    <body>
        <h1>App::Donburi - IRCを使い倒すアプリ</h1>
        tag
            <a href='/tag/perl'>perl</a>
            <a href='/tag/irc'>irc</a>

        
<div class="section">
    <h4>はじめに</h4>
    <p>こんばんは。大遅刻に定評のあるふしはらかんです。……皆さんごめんなさい。<br />
App::Donburiは名前空間から分かるように、ライブラリではなくアプリケーションです。Donburiという名前は開発中に丼が食べたかったという理不尽な理由で付けられたものでアプリの機能とは全く関係なく、バッチ等からIRCへの通知を簡単にする、というのがdonburiの簡単な説明になります。</p>

</div>
<div class="section">
    <h4>インストール & 起動</h4>
    <p>App::DonburiはCPANにアップロード済みなので、cpan(cpanm)コマンドで簡単に導入できます。</p>

    <pre class="code prettyprint lang-sh">cpanm App::Donburi</pre>
<p>インストールが済んだら、donburiコマンドを実行してみましょう。</p>

    <pre class="code prettyprint lang-sh">% donburi
donburi need &#39;config.yaml&#39;. I write config.yaml sample at ./config.yaml . please edit it</pre>
<p>設定ファイルが無いのでサンプル置いたよ。とのことなので、config.yamlを開いてみます。</p>

    <pre class="code prettyprint lang-yaml">---
irc:
  server: &#34;irc.freenode.net&#34;
  port: 6667
  nick: &#34;donburi&#34;
  encoding: &#34;utf-8&#34;

http:
  server: &#34;127.0.0.1&#34;
  port: 8080

store: &#34;./channel.yaml&#34;</pre>
<p>大抵の場合、変える必要があるのはircのserverと、httpのportあたりですね。通知を行なうIRC serverのホスト名を指定したら、改めてdonburiコマンドを実行すると、今度は起動すると思います。config.yamlで指定したhttpのportにブラウザでアクセスしてみましょう。</p>

</div>
<div class="section">
    <h3>設定する</h3>
    <p>ブラウザでアクセスすると設定画面が開きます。channelの欄の「edit」をクリックすると、通知を行なうチャンネルの管理が出来ます。チャンネルを追加すると、donburiのbot(初期設定だとdonburiというnick)が、チャンネルにjoinしてくると思います。</p><p>TOP画面に戻って、channelを選択してmessage欄に何か入力してpostしてみると</p>

    <pre class="code prettyprint">22:19 donburi has joined (~donburi@KD113149019186.ppp-bb.dion.ne.jp)
22:22 donburi: こんばんは!!!
22:23 __kan: donburi: クリスマスイヴになにやってんだ……</pre>
<p>このようにIRCに通知されます。</p>

</div>
<div class="section">
    <h3>スクリプトから利用する</h3>
    <p>Web画面からのアクセスは確認用のようなもので、実際にはスクリプト等からAPIを叩いて利用することになります。donburiのAPIはJSON RPCなので投稿用のスクリプトは</p>

    <pre class="code prettyprint lang-perl">use JSON::RPC::Client;

my $uri = &#39;http://localhost:8080/&#39;;
my $method = &#39;privmsg&#39;;
my @params = (&#39;#subtech&#39;, &#39;kan: 涙拭けよ……&#39;);

my $client = JSON::RPC::Client-&gt;new;
my $res = $client-&gt;call($uri, { method =&gt; $method, params =&gt; \@params }); </pre>
<p>のように簡単に書くことが出来ます。ちなむと、APIの仕様はApp::Nakanobuという、perlで書かれた同じようなことが出来るアプリのものと共通のため、通知の処理を使い回すことが出来ます。</p>

</div>
<div class="section">
    <h3>まとめ</h3>
    <p>これを書いてる時点では社内コミュニケーションにバリバリIRCを使っている会社に勤めていたのですが、今はSkypeを使う会社に移ってしまったので自分で使う機会が無くなってしまいました……。とはいえ、個人的にはIRCを使い続けてますし、donburiの開発も継続していくつもりです。とりあえずダサいWeb画面をもうちょっとなんとかしたいところ……。ほぼ同じ時期に開発されたApp::Ikachanというツールがありますが、donburiはなるべく設定ファイルを使わずにWebからの設定のみで動かせるというコンセプトで頑張ります。</p>

</div>
        <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=css&amp;skin=sunburst"></script>
    </body>
</html>
