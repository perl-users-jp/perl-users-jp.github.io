<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>ファイルの扱い - Articles Advent Calendar 2010 Perl6</title>
        <meta name="title" content="ファイルの扱い - Articles Advent Calendar 2010 Perl6">
        <meta name="description" content="">
        <meta name="author" content="risou <risou.f@gmail.com>">

        <meta property="og:type" content="website">
        <meta property="og:url" content="https://perl-users.jp/articles/advent-calendar/2010/perl6/11">
        <meta property="og:title" content="ファイルの扱い - Articles Advent Calendar 2010 Perl6">
        <meta property="og:description" content="">
        <meta property="og:image" content="https://res.cloudinary.com/kfly8/image/upload/l_text:NotoSansJP-Black.otf_50_bold:%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%89%B1%E3%81%84,co_rgb:000000,w_900,c_fit/l_text:NotoSansJP-Black.otf_30_bold:risou%20%3Crisou.f%40gmail.com%3E,co_rgb:000000,g_south_east,x_130,y_120/v1601626948/og-perl-users-jp.png">

        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://perl-users.jp/articles/advent-calendar/2010/perl6/11">
        <meta property="twitter:title" content="ファイルの扱い - Articles Advent Calendar 2010 Perl6">
        <meta property="twitter:description" content="">
        <meta property="twitter:image" content="https://res.cloudinary.com/kfly8/image/upload/l_text:NotoSansJP-Black.otf_50_bold:%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%89%B1%E3%81%84,co_rgb:000000,w_900,c_fit/l_text:NotoSansJP-Black.otf_30_bold:risou%20%3Crisou.f%40gmail.com%3E,co_rgb:000000,g_south_east,x_130,y_120/v1601626948/og-perl-users-jp.png">

        <link rel="icon" href="/img/favicon.ico">
        <link rel="canonical" href="https://perl-users.jp/articles/advent-calendar/2010/perl6/11">
        <link href="TODO" rel="stylesheet">
    </head>
    <body>
        <h1>ファイルの扱い</h1>
        tag

        
<div class="section">
    <h3>ファイルの読み書き</h3>
    <p>実用的なプログラムの多くに欠かせないものの一つとして、ファイルの読み書きがあります。まずは Perl 6 でのファイルの扱い方を例示してみましょう。<br />
まずはファイル読み込みの例です。</p>

    <pre class="code prettyprint">my $file = open &#39;filename&#39;;

for $file.lines -&gt; $line {
	say $line;
}

close $file;</pre>
<p>次にファイル書き込みの例です。</p>

    <pre class="code prettyprint">my $file = open &#39;filename&#39;, :w;

$file.say(&#39;output text for file.&#39;);

close $file;</pre>
<p>ファイル書き込みの場合は、 open 関数の第二引数に ":w" を指定してください。読み込みの場合は第二引数に ":r" ですが、これはデフォルト値なので、第二引数を指定しなければファイル読み込みになります(上記例参照)。</p><p>また、ファイル読み込みについては、 Perl 6 では slurp というファイルの中身を String で返す関数があります。</p>

    <pre class="code prettyprint">$ perl6
&gt; slurp &#39;filename&#39;
output text for file.

&gt;</pre>

</div>
<div class="section">
    <h3>補足：文字コードについて</h3>
    <p>Perl 6 で現在扱える文字コードは限られています(UTF-8, ascii, iso-8859-1)。現時点で日本語を扱うのであれば、文字コードは UTF-8 一択になります。</p><p>実際に UTF-8 と Shift-JIS のファイルを読み込んでみましょう。</p>

    <pre class="code prettyprint">このファイルは、
文字コード： UTF-8
改行コード： LF
で作成されました。</pre>
<p>上記は UTF-8 ( LF ) で作成したテキストファイルです。このファイルを読み込むと以下の様になります。</p>

    <pre class="code prettyprint">$ perl6
&gt; slurp &#39;utf8&#39;
このファイルは、
文字コード： UTF-8
改行コード： LF
で作成されました。
&gt;</pre>
<p>次に Shift-JIS ( CRLF ) で作成したテキストファイルを読み込んでみましょう。</p>

    <pre class="code prettyprint">このファイルは、
文字コード： Shift-JIS
改行コード： CRLF
で作成されました。</pre>
<p>このファイルを読み込むと以下の様にエラーとなります。</p>

    <pre class="code prettyprint">$ perl6
&gt; slurp &#39;sjis&#39;
Malformed UTF-8 string

&gt;</pre>
<p>また、テキストファイルの文字コードだけでなく、 .pl ファイルの文字コードにも注意が必要です。</p>

    <pre class="code prettyprint">#!/usr/bin/env perl6
use v6;

say &#34;このファイルの情報：&#34;;
say &#34;　文字コード： UTF-8&#34;;
say &#34;　改行コード： LF&#34;;</pre>
<p>上記スクリプトを実行すると、意図した通りの結果が出力されます。</p>

    <pre class="code prettyprint">$ perl6 utf8.pl
このファイルの情報：
　文字コード： UTF-8
　改行コード： LF</pre>
<p>最後に Shift-JIS で書かれた以下の .pl ファイルを実行してみましょう。</p>

    <pre class="code prettyprint">#!/usr/bin/env perl6
use v6;

say &#34;このファイルの情報：&#34;;
say &#34;　文字コード： Shift-JIS&#34;;
say &#34;　改行コード： CRLF&#34;;</pre>
<p>実行結果は以下の様になります。やはりエラーが出力されました。</p>

    <pre class="code prettyprint">$ perl6 sjis.pl
===SORRY!===
Malformed UTF-8 string</pre>
<p>日本語を扱う場合、当面はスクリプトも扱うファイルも UTF-8 にしておきましょう。一刻も早く Perl 5 の Encode.pm のようなモジュールが必要ですね。</p>

</div>
        <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=css&amp;skin=sunburst"></script>
    </body>
</html>
